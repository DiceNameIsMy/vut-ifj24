.IFJcode24

# It's easiest to jump to main at the beginning, 
# because we can't define functions after main.

CALL main
JUMP endProgram

# Expects:
# - LF@number
# - LF@string
# Returns: 
#   A return value is pushed on the stack. 
#   If return value is not scpeficied, nothing is pushed.
LABEL func
    # Define local variables
    DEFVAR LF@v1

    # Useful code
    LABEL loop
    JUMPIFEQ end LF@number int@0

    EQ LF@v1 LF@number int@3
    JUMPIFEQ not_early_return LF@v1 bool@false

    RETURN

    LABEL not_early_return

    WRITE LF@string
    SUB LF@number LF@number int@1

    JUMP loop

    LABEL end
    # End useful code

    RETURN

LABEL main
    # Create frame for local variables
    CREATEFRAME
    PUSHFRAME

    # Define a variable
    DEFVAR LF@magic_number
    MOVE LF@magic_number int@5

    # Create TF frame for function parameters
    CREATEFRAME

    # Set function parameters
    DEFVAR TF@number
    MOVE TF@number LF@magic_number
    DEFVAR TF@string
    MOVE TF@string string@Hello\032World!\010

    # Call function
    PUSHFRAME # Move TF to LF as that's what a function expects
    CALL func
    POPFRAME # Get rid of the function's local frame

    # Remove a frame for local variables
    POPFRAME

    # Main function is special: it does not have a return at the end.
    RETURN

LABEL endProgram